<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:aop="http://www.springframework.org/schema/aop" xmlns:util="http://www.springframework.org/schema/util"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
		http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-3.0.xsd
		http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-3.0.xsd">


	<bean id="flowControl" class="com.sicpa.standard.sasscl.controller.flow.FlowControl" init-method="initMachine">
		<property name="stateMachine" ref="stateMachine" />
		<property name="flowControlWiring" ref="flowControlWiring" />
	</bean>

	<bean id="stateMachine" class="com.sicpa.standard.sasscl.controller.flow.statemachine.FlowControlStateMachine">
		<constructor-arg value="#{flowControlWiring.getInitialState()}" />
	</bean>

	<bean id="flowControlWiring" class="com.sicpa.standard.sasscl.controller.flow.statemachine.DefaultFlowControlWiring">
		<property name="executorExit" ref="executorExit" />
		<property name="executorStarted" ref="executorStarted" />
		<property name="executorStarting" ref="executorStarting" />
		<property name="executorNoSelection" ref="executorNoSelection" />
		<property name="executorConnecting" ref="executorConnecting" />
		<property name="executorSelectWithPrevious" ref="executorSelectWithPrevious" />
		<property name="executorConnected" ref="executorConnected" />
		<property name="executorSelectNoPrevious" ref="executorSelectNoPrevious" />
		<property name="executorStopping" ref="executorStopping" />
		<property name="executorRecovering" ref="executorRecovering" />
		<property name="executorDisconnectingOnParamChanged" ref="executorDisconnectingOnParamChanged" />
	</bean>

	<bean id="executorRecovering" class="com.sicpa.standard.sasscl.controller.flow.statemachine.executor.ExecutorRecovering" />

	<bean id="executorExit" class="com.sicpa.standard.sasscl.controller.flow.statemachine.executor.ExecutorExit">
		<property name="hardwareController" ref="hardwareController" />
		<property name="production" ref="production" />
		<property name="storage" ref="storage" />
		<property name="statistics" ref="statistics" />
		<property name="screensFlow" ref="screensFlow" />
		<property name="switchOffPrinterOnExit" value="${exit.printer.switchoff}" />
	</bean>

	<bean id="executorStarted" class="com.sicpa.standard.sasscl.controller.flow.statemachine.executor.ExecutorStarted" />

	<bean id="executorStarting" class="com.sicpa.standard.sasscl.controller.flow.statemachine.executor.ExecutorStarting">
		<property name="alert" ref="alert" />
		<property name="productionBatchProvider" ref="productionBatchProvider" />
		<property name="hardwareController" ref="hardwareController" />
		<property name="startValidators">
			<bean id="globalStartProductionValidator" class="com.sicpa.standard.client.common.controller.predicate.start.GlobalStartProductionValidator">
				<property name="validators">
					<list>
						<ref bean="maxRemoteServerDownTimeListener" />
						<ref bean="parametersAvailableStartValidator" />
					</list>
				</property>
			</bean>
		</property>
	</bean>
	<bean id="executorNoSelection" class="com.sicpa.standard.sasscl.controller.flow.statemachine.executor.ExecutorNoSelection" />
	<bean id="executorConnecting" class="com.sicpa.standard.sasscl.controller.flow.statemachine.executor.ExecutorConnecting">
		<property name="hardwareController" ref="hardwareController" />
		<property name="productionParameters" ref="productionParameters" />
		<property name="productionInitiator" ref="productionInitiator" />
		<property name="loader" ref="productionConfigLoader" />
		<property name="productionConfigProvider" ref="productionConfigProvider" />
		<property name="statistics" ref="statistics" />
	</bean>
	<bean id="executorSelectWithPrevious" class="com.sicpa.standard.sasscl.controller.flow.statemachine.executor.ExecutorSelectWithPrevious">
		<property name="screensFlow" ref="screensFlow" />
	</bean>
	<bean id="executorConnected" class="com.sicpa.standard.sasscl.controller.flow.statemachine.executor.ExecutorConnected" />
	<bean id="executorSelectNoPrevious" class="com.sicpa.standard.sasscl.controller.flow.statemachine.executor.ExecutorSelectNoPrevious">
		<property name="screensFlow" ref="screensFlow" />
	</bean>
	<bean id="executorStopping" class="com.sicpa.standard.sasscl.controller.flow.statemachine.executor.ExecutorStopping">
		<property name="hardwareController" ref="hardwareController" />
		<property name="alert" ref="alert" />
	</bean>
	<bean id="executorDisconnectingOnParamChanged" class="com.sicpa.standard.sasscl.controller.flow.statemachine.executor.ExecutorDisconnectingOnParamChanged">
		<property name="hardwareController" ref="hardwareController" />
	</bean>


	<bean id="hardwareControllerStatusListener" class="com.sicpa.standard.sasscl.controller.flow.listener.HardwareControllerStatusListener">
		<property name="flowControl" ref="flowControl" />
	</bean>

	<bean id="printerListener" class="com.sicpa.standard.sasscl.controller.flow.listener.PrinterListener">
		<property name="stateMachine" ref="stateMachine" />
	</bean>

	<bean id="productionParameterChangedListener" class="com.sicpa.standard.sasscl.controller.flow.listener.ProductionParameterChangedListener">
		<property name="storage" ref="storage" />
		<property name="flowControl" ref="flowControl" />
	</bean>



	<!-- production parameters START VALIDATORS -->

	<bean id="parametersAvailableStartValidator" class="com.sicpa.standard.sasscl.controller.flow.validator.ParametersAvailableStartValidator">
		<property name="productionParameters" ref="productionParameters" />
		<property name="skuListProvider" ref="skuListProvider" />
	</bean>

	<!-- max downtine listener -->
	<bean id="maxRemoteServerDownTimeListener" class="com.sicpa.standard.sasscl.controller.flow.listener.MaxRemoteServerDownTimeListener" />

</beans>
