<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:util="http://www.springframework.org/schema/util"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-3.0.xsd">

	<bean id="stdRemoteServer" class="com.sicpa.tt018.scl.remoteServer.AlbaniaRemoteServer">
		<constructor-arg ref="stdRemoteModel" />
		<property name="cryptoPassword" value="${crypto.password}" />
		<property name="cryptoFieldsConfig" ref="cryptoFieldsConfig" />
		<property name="remoteServerAdapter" ref="remoteServerAdaptor" />
		<property name="ejbCodingActivationBean" ref="ejbCodingActivationBean" />
		<property name="storage" ref="storage" />
		<property name="lifeChecker" ref="lifeCheckerSTD" />
		<property name="subSystemId" value="${master.subsystemId}" />
	</bean>

	<!-- override this one storage simulator is used by other components otherwise -->
	<bean id="storageSimulator" class="com.sicpa.standard.sasscl.common.storage.FileStorage">
		<constructor-arg value="${profile.path}/simuStorage/dataFolder" />
		<constructor-arg value="${profile.path}/simuStorage/internalFolder" />
		<constructor-arg value="${profile.path}/simuStorage/quarantineFolder" />
		<constructor-arg ref="storageBehavior" />
		<property name="productsPackager" ref="productsPackager" />
		<property name="fileSequenceProvider" ref="fileSequenceStorageProvider" />
		<property name="cleanUpSendDataThreshold_day" value="${cleanUpSendDataThreshold_day}" />
	</bean>

	<bean id="remoteServerSimulator" class="com.sicpa.tt018.scl.remoteServer.simu.AlbaniaRemoteServerSimulator"
		init-method="loadModel">
		<constructor-arg ref="stdRemoteModel" />
		<property name="subSystemId" value="${master.subsystemId}" />
		<property name="remoteServerAdapter" ref="remoteServerAdaptor" />
		<property name="lifeChecker" ref="lifeCheckerSimu" />
		<property name="storage" ref="storageSimulator" />
		<property name="pathToRemoteServerFile" value="${profile.path}/config/server/simulator/remoteServerSimulator.xml" />
		<property name="cryptoPassword" value="${crypto.password}" />
		<property name="cryptoFieldsConfig" ref="cryptoFieldsConfig" />
	</bean>

	<bean id="lifeCheckerSTD" class="com.sicpa.standard.sasscl.devices.remote.impl.RemoteServerLifeChecker">
		<property name="lifeCheckSleep" value="30000" />
		<property name="target" ref="stdRemoteServer" />
	</bean>

	<bean id="lifeCheckerSimu" class="com.sicpa.standard.sasscl.devices.remote.impl.RemoteServerLifeChecker">
		<property name="lifeCheckSleep" value="30000" />
		<property name="target" ref="remoteServerSimulator" />
	</bean>

	<bean id="remoteServerAdaptor" class="com.sicpa.tt018.scl.remoteServer.adapter.AlbaniaRemoteServerAdapter">
		<property name="treeDepth" value="${sku.tree.depth}" />
		<property name="allowedProductType" value="${remoteServerAdapter.allowedProductType}" />
	</bean>

	<bean id="ejbCodingActivationBean" class="org.springframework.ejb.access.SimpleRemoteStatelessSessionProxyFactoryBean">
		<property name="jndiName" value="CodingActivationBean/remote" />
		<property name="businessInterface" value="com.sicpa.tt018.interfaces.scl.master.ICodingActivationRemote" />
		<property name="jndiTemplate">
			<ref bean="jndiTemplate" />
		</property>
		<property name="lookupHomeOnStartup" value="false" />
		<property name="cacheHome" value="false" />
		<property name="refreshHomeOnConnectFailure" value="true" />
	</bean>

	<bean id="jndiTemplate" class="com.sicpa.tt018.scl.remoteServer.AlbaniaJndiTemplate" lazy-init="true">
		<property name="environment">
			<props>
				<prop key="java.naming.factory.initial">org.jboss.security.jndi.JndiLoginInitialContextFactory
				</prop>
				<prop key="java.naming.provider.url">${master.url}</prop>
				<prop key="java.naming.factory.url.pkgs">org.jboss.naming:org.jnp.interfaces</prop>
				<prop key="jnp.socketFactory">org.jnp.interfaces.TimedSocketFactory</prop>
				<prop key="jnp.timeout">5000</prop>
				<prop key="jnp.sotimeout">5000</prop>
				<prop key="jnp.maxRetries">5</prop>
				<prop key="jnp.discoveryTimeout">5000</prop>
				<prop key="jnp.multi-threaded">true</prop>
				<prop key="com.sicpa.username">${master.login}</prop>
				<prop key="com.sicpa.subsystemId">${master.subsystemId}</prop>
				<prop key="com.sicpa.password">${master.password}</prop>
			</props>
		</property>
	</bean>



	<util:map id="mapRemoteServerController">
		<entry key="standard" value-ref="stdRemoteServer" />
		<entry key="simulator" value-ref="remoteServerSimulator" />
	</util:map>

	<bean id="stdRemoteModel" class="com.sicpa.standard.client.common.utils.ConfigUtils" factory-method="load">
		<constructor-arg value="${profile.path}/config/server/remoteServer.xml" />
	</bean>

	<bean id="cryptoFieldsConfig" class="com.sicpa.tt018.scl.model.crypto.AlbaniaSCLCryptoFieldsConfig" />

	<bean id="remoteServer" factory-bean="mapRemoteServerController" factory-method="get">
		<constructor-arg value="${remoteServer.behavior}" />
	</bean>

</beans>